<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker Compose</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.a0ada997.css" as="style"><link rel="preload" href="/assets/js/app.a8d644b6.js" as="script"><link rel="preload" href="/assets/js/2.b0571e25.js" as="script"><link rel="preload" href="/assets/js/57.c4b7c57f.js" as="script"><link rel="prefetch" href="/assets/js/10.c8889642.js"><link rel="prefetch" href="/assets/js/100.51a741fb.js"><link rel="prefetch" href="/assets/js/101.d9dbfe05.js"><link rel="prefetch" href="/assets/js/102.52466a3b.js"><link rel="prefetch" href="/assets/js/103.3cf394c6.js"><link rel="prefetch" href="/assets/js/104.90d3018b.js"><link rel="prefetch" href="/assets/js/105.dd9bdeef.js"><link rel="prefetch" href="/assets/js/106.6bda79d0.js"><link rel="prefetch" href="/assets/js/107.ef743f0b.js"><link rel="prefetch" href="/assets/js/108.fa92013e.js"><link rel="prefetch" href="/assets/js/109.50afa695.js"><link rel="prefetch" href="/assets/js/11.e31c3ea5.js"><link rel="prefetch" href="/assets/js/110.aad632dd.js"><link rel="prefetch" href="/assets/js/111.499096ad.js"><link rel="prefetch" href="/assets/js/112.6069b48f.js"><link rel="prefetch" href="/assets/js/113.b8841596.js"><link rel="prefetch" href="/assets/js/114.23496351.js"><link rel="prefetch" href="/assets/js/115.e08ac3c1.js"><link rel="prefetch" href="/assets/js/116.760ebdb3.js"><link rel="prefetch" href="/assets/js/117.f226c0c1.js"><link rel="prefetch" href="/assets/js/118.65289b19.js"><link rel="prefetch" href="/assets/js/119.e3cf777f.js"><link rel="prefetch" href="/assets/js/12.78a1ab5b.js"><link rel="prefetch" href="/assets/js/120.7760e751.js"><link rel="prefetch" href="/assets/js/121.05ec49dd.js"><link rel="prefetch" href="/assets/js/122.688774b7.js"><link rel="prefetch" href="/assets/js/123.06bf7f11.js"><link rel="prefetch" href="/assets/js/124.62bfda58.js"><link rel="prefetch" href="/assets/js/125.eda5b500.js"><link rel="prefetch" href="/assets/js/126.1b39c0b0.js"><link rel="prefetch" href="/assets/js/127.65be59e4.js"><link rel="prefetch" href="/assets/js/128.25fbb5dc.js"><link rel="prefetch" href="/assets/js/129.cd5e2b4b.js"><link rel="prefetch" href="/assets/js/13.6a543448.js"><link rel="prefetch" href="/assets/js/130.fcc93329.js"><link rel="prefetch" href="/assets/js/131.6d7c37d1.js"><link rel="prefetch" href="/assets/js/132.09cf25fb.js"><link rel="prefetch" href="/assets/js/133.583d15f0.js"><link rel="prefetch" href="/assets/js/134.7b72ef87.js"><link rel="prefetch" href="/assets/js/135.733d2857.js"><link rel="prefetch" href="/assets/js/136.b8649b26.js"><link rel="prefetch" href="/assets/js/137.e71138fa.js"><link rel="prefetch" href="/assets/js/138.95b4f55f.js"><link rel="prefetch" href="/assets/js/139.c09e22b6.js"><link rel="prefetch" href="/assets/js/14.819689ab.js"><link rel="prefetch" href="/assets/js/140.71186b46.js"><link rel="prefetch" href="/assets/js/141.5bb51b5a.js"><link rel="prefetch" href="/assets/js/142.94804f8e.js"><link rel="prefetch" href="/assets/js/143.7191f64e.js"><link rel="prefetch" href="/assets/js/144.d2957568.js"><link rel="prefetch" href="/assets/js/145.651e0adf.js"><link rel="prefetch" href="/assets/js/146.d0a83694.js"><link rel="prefetch" href="/assets/js/147.fc4d286f.js"><link rel="prefetch" href="/assets/js/148.410aec93.js"><link rel="prefetch" href="/assets/js/149.a453f4de.js"><link rel="prefetch" href="/assets/js/15.5bc49d67.js"><link rel="prefetch" href="/assets/js/150.77f0ea12.js"><link rel="prefetch" href="/assets/js/151.c808f32e.js"><link rel="prefetch" href="/assets/js/152.22e5d574.js"><link rel="prefetch" href="/assets/js/153.bc4da283.js"><link rel="prefetch" href="/assets/js/154.fa61ee21.js"><link rel="prefetch" href="/assets/js/155.42087f9f.js"><link rel="prefetch" href="/assets/js/156.7745074e.js"><link rel="prefetch" href="/assets/js/157.804702be.js"><link rel="prefetch" href="/assets/js/158.b6fe8f70.js"><link rel="prefetch" href="/assets/js/159.8a7a433b.js"><link rel="prefetch" href="/assets/js/16.434879fd.js"><link rel="prefetch" href="/assets/js/160.1a976dd2.js"><link rel="prefetch" href="/assets/js/161.14311375.js"><link rel="prefetch" href="/assets/js/162.6bbdd1e5.js"><link rel="prefetch" href="/assets/js/163.2c60a568.js"><link rel="prefetch" href="/assets/js/164.e7567976.js"><link rel="prefetch" href="/assets/js/165.7a2dc778.js"><link rel="prefetch" href="/assets/js/166.c9a838e8.js"><link rel="prefetch" href="/assets/js/17.14403580.js"><link rel="prefetch" href="/assets/js/18.08ac9cad.js"><link rel="prefetch" href="/assets/js/19.2c183b64.js"><link rel="prefetch" href="/assets/js/20.32bb3cb9.js"><link rel="prefetch" href="/assets/js/21.d966558e.js"><link rel="prefetch" href="/assets/js/22.c75c7c76.js"><link rel="prefetch" href="/assets/js/23.7fd7f7c3.js"><link rel="prefetch" href="/assets/js/24.36b6b4eb.js"><link rel="prefetch" href="/assets/js/25.8f357f46.js"><link rel="prefetch" href="/assets/js/26.61d906dd.js"><link rel="prefetch" href="/assets/js/27.08330a35.js"><link rel="prefetch" href="/assets/js/28.b1e01410.js"><link rel="prefetch" href="/assets/js/29.936218e3.js"><link rel="prefetch" href="/assets/js/3.3214ea23.js"><link rel="prefetch" href="/assets/js/30.c0b9efde.js"><link rel="prefetch" href="/assets/js/31.5b6e3df7.js"><link rel="prefetch" href="/assets/js/32.6374edaf.js"><link rel="prefetch" href="/assets/js/33.928e8282.js"><link rel="prefetch" href="/assets/js/34.92067108.js"><link rel="prefetch" href="/assets/js/35.154d21dd.js"><link rel="prefetch" href="/assets/js/36.e5ad0869.js"><link rel="prefetch" href="/assets/js/37.385b33d5.js"><link rel="prefetch" href="/assets/js/38.215a6333.js"><link rel="prefetch" href="/assets/js/39.bbf6207d.js"><link rel="prefetch" href="/assets/js/4.d34ebd53.js"><link rel="prefetch" href="/assets/js/40.bc0f7c00.js"><link rel="prefetch" href="/assets/js/41.3ba84cff.js"><link rel="prefetch" href="/assets/js/42.04a42e98.js"><link rel="prefetch" href="/assets/js/43.9a5e58fa.js"><link rel="prefetch" href="/assets/js/44.ad33bbd6.js"><link rel="prefetch" href="/assets/js/45.17f6595d.js"><link rel="prefetch" href="/assets/js/46.a5afba11.js"><link rel="prefetch" href="/assets/js/47.838086e6.js"><link rel="prefetch" href="/assets/js/48.34f3613a.js"><link rel="prefetch" href="/assets/js/49.726aa7d7.js"><link rel="prefetch" href="/assets/js/5.95ea0968.js"><link rel="prefetch" href="/assets/js/50.cb833116.js"><link rel="prefetch" href="/assets/js/51.3ed1ad45.js"><link rel="prefetch" href="/assets/js/52.54cf0f85.js"><link rel="prefetch" href="/assets/js/53.513a15ca.js"><link rel="prefetch" href="/assets/js/54.48b671a4.js"><link rel="prefetch" href="/assets/js/55.4ea41ff7.js"><link rel="prefetch" href="/assets/js/56.2c85bb70.js"><link rel="prefetch" href="/assets/js/58.8645cbfa.js"><link rel="prefetch" href="/assets/js/59.93bb241a.js"><link rel="prefetch" href="/assets/js/6.d3d6f703.js"><link rel="prefetch" href="/assets/js/60.bb6e6605.js"><link rel="prefetch" href="/assets/js/61.286ce4e5.js"><link rel="prefetch" href="/assets/js/62.faedf14e.js"><link rel="prefetch" href="/assets/js/63.ce821da4.js"><link rel="prefetch" href="/assets/js/64.d3bd4444.js"><link rel="prefetch" href="/assets/js/65.6dce8124.js"><link rel="prefetch" href="/assets/js/66.9926dcf1.js"><link rel="prefetch" href="/assets/js/67.8ba47f6f.js"><link rel="prefetch" href="/assets/js/68.fb08fa45.js"><link rel="prefetch" href="/assets/js/69.99366761.js"><link rel="prefetch" href="/assets/js/7.65a53a16.js"><link rel="prefetch" href="/assets/js/70.b58184ca.js"><link rel="prefetch" href="/assets/js/71.e807ce86.js"><link rel="prefetch" href="/assets/js/72.fd85a201.js"><link rel="prefetch" href="/assets/js/73.347f4455.js"><link rel="prefetch" href="/assets/js/74.1614468f.js"><link rel="prefetch" href="/assets/js/75.1b48dd21.js"><link rel="prefetch" href="/assets/js/76.34386640.js"><link rel="prefetch" href="/assets/js/77.98723d2f.js"><link rel="prefetch" href="/assets/js/78.853e0232.js"><link rel="prefetch" href="/assets/js/79.f13b56d9.js"><link rel="prefetch" href="/assets/js/8.1f5a2468.js"><link rel="prefetch" href="/assets/js/80.9b7ea6e5.js"><link rel="prefetch" href="/assets/js/81.b6c297c9.js"><link rel="prefetch" href="/assets/js/82.0f97cc22.js"><link rel="prefetch" href="/assets/js/83.31634315.js"><link rel="prefetch" href="/assets/js/84.c8e9154d.js"><link rel="prefetch" href="/assets/js/85.961b5b48.js"><link rel="prefetch" href="/assets/js/86.0656beb0.js"><link rel="prefetch" href="/assets/js/87.2216b902.js"><link rel="prefetch" href="/assets/js/88.5f59eb52.js"><link rel="prefetch" href="/assets/js/89.c1a19999.js"><link rel="prefetch" href="/assets/js/9.4ab6239e.js"><link rel="prefetch" href="/assets/js/90.c3ffff3a.js"><link rel="prefetch" href="/assets/js/91.093bc4a1.js"><link rel="prefetch" href="/assets/js/92.b98a6c4b.js"><link rel="prefetch" href="/assets/js/93.721ce10b.js"><link rel="prefetch" href="/assets/js/94.2c601c95.js"><link rel="prefetch" href="/assets/js/95.d1677f3d.js"><link rel="prefetch" href="/assets/js/96.e71019bc.js"><link rel="prefetch" href="/assets/js/97.d7a92048.js"><link rel="prefetch" href="/assets/js/98.21bdf582.js"><link rel="prefetch" href="/assets/js/99.5df4fe80.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0ada997.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="什么是-docker-compose"><a href="#什么是-docker-compose" aria-hidden="true" class="header-anchor">#</a> 什么是 Docker Compose</h2> <p>Docker Compose 是 Docker 官方编排（Orchestration）项目之一，负责快速的部署分布式应用。</p> <h2 id="docker-compose-简介"><a href="#docker-compose-简介" aria-hidden="true" class="header-anchor">#</a> Docker Compose 简介</h2> <p><code>Compose</code> 项目是 <code>Docker </code>官方的开源项目，负责实现对 <code>Docker</code> 容器集群的快速编排。从功能上看，跟 OpenStack 中的 Heat 十分类似。</p> <p>其代码目前在 <code>https://github.com/docker/compose</code> 上开源。</p> <p>Compose 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p> <p>通过第一部分中的介绍，我们知道使用一个 Dockerfile 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p> <p>Compose 恰好满足了这样的需求。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p> <p>Compose 中有两个重要的概念：</p> <p>服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。
项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。
Compose 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p> <p>Compose 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 Compose 来进行编排管理。</p> <h2 id="docker-compose-安装与卸载"><a href="#docker-compose-安装与卸载" aria-hidden="true" class="header-anchor">#</a> Docker Compose 安装与卸载</h2> <p>Compose 支持 Linux、macOS、Windows 10 三大平台。</p> <p>Compose 可以通过 Python 的包管理工具 pip 进行安装，也可以直接下载编译好的二进制文件使用，甚至能够直接在 Docker 容器中运行。</p> <p>前两种方式是传统方式，适合本地环境下安装使用；最后一种方式则不破坏系统环境，更适合云计算场景。</p> <p>Docker for Mac 、Docker for Windows 自带 docker-compose 二进制文件，安装 Docker 之后可以直接使用。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ docker-compose --version
</code></pre></div><p>docker-compose version 1.17.1, build 6d101fb
Linux 系统请使用以下介绍的方法安装。</p> <h3 id="二进制包"><a href="#二进制包" aria-hidden="true" class="header-anchor">#</a> 二进制包</h3> <p>在 Linux 上的也安装十分简单，从 [官方GitHub Release] (https://github.com/docker/compose/releases) 处直接下载编译好的二进制文件即可。</p> <p>例如，在 Linux 64 位系统上直接下载对应的二进制包。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> <span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
$ <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre></div><h3 id="pip-安装"><a href="#pip-安装" aria-hidden="true" class="header-anchor">#</a> PIP 安装</h3> <p>注： x86_64 架构的 Linux 建议按照上边的方法下载二进制包进行安装，如果您计算机的架构是 ARM (例如，树莓派)，再使用 pip 安装。</p> <p>这种方式是将 Compose 当作一个 Python 应用来从 pip 源中安装。</p> <p>执行安装命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">sudo</span> pip <span class="token function">install</span> -U docker-compose
</code></pre></div><p>可以看到类似如下输出，说明安装成功。</p> <p>Collecting docker-compose
Downloading docker-compose-1.17.1.tar.gz (149kB): 149kB downloaded
...
Successfully installed docker-compose cached-property requests texttable websocket-client docker-py dockerpty six enum34 backports.ssl-match-hostname ipaddress</p> <h3 id="bash-补全命令"><a href="#bash-补全命令" aria-hidden="true" class="header-anchor">#</a> bash 补全命令</h3> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.8.0/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose

</code></pre></div><h3 id="容器中执行"><a href="#容器中执行" aria-hidden="true" class="header-anchor">#</a> 容器中执行</h3> <p>Compose 既然是一个 Python 应用，自然也可以直接用容器来执行它。</p> <p><code>$ curl -L https://github.com/docker/compose/releases/download/1.8.0/run.sh &gt; /usr/local/bin/docker-compose</code> <code>$ chmod +x /usr/local/bin/docker-compose</code>
实际上，查看下载的 run.sh 脚本内容，如下</p> <p>set -e</p> <p>VERSION=&quot;1.8.0&quot;
IMAGE=&quot;docker/compose:$VERSION&quot;</p> <h3 id="setup-options-for-connecting-to-docker-host"><a href="#setup-options-for-connecting-to-docker-host" aria-hidden="true" class="header-anchor">#</a> Setup options for connecting to docker host</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">$DOCKER_HOST</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">DOCKER_HOST</span><span class="token operator">=</span><span class="token string">&quot;/var/run/docker.sock&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -S <span class="token string">&quot;<span class="token variable">$DOCKER_HOST</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">DOCKER_ADDR</span><span class="token operator">=</span><span class="token string">&quot;-v <span class="token variable">$DOCKER_HOST</span>:<span class="token variable">$DOCKER_HOST</span> -e DOCKER_HOST&quot;</span>
<span class="token keyword">else</span>
    <span class="token assign-left variable">DOCKER_ADDR</span><span class="token operator">=</span><span class="token string">&quot;-e DOCKER_HOST -e DOCKER_TLS_VERIFY -e DOCKER_CERT_PATH&quot;</span>
<span class="token keyword">fi</span>

</code></pre></div><h3 id="setup-volume-mounts-for-compose-config-and-context"><a href="#setup-volume-mounts-for-compose-config-and-context" aria-hidden="true" class="header-anchor">#</a> Setup volume mounts for compose config and context</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">!=</span> <span class="token string">'/'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">VOLUMES</span><span class="token operator">=</span><span class="token string">&quot;-v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>:<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$COMPOSE_FILE</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">compose_dir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> $COMPOSE_FILE<span class="token variable">)</span></span>
<span class="token keyword">fi</span>
</code></pre></div><h3 id="todo-also-check-file-argument"><a href="#todo-also-check-file-argument" aria-hidden="true" class="header-anchor">#</a> TODO: also check --file argument</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">$compose_dir</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">VOLUMES</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$VOLUMES</span> -v <span class="token variable">$compose_dir</span>:<span class="token variable">$compose_dir</span>&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token environment constant">$HOME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">VOLUMES</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$VOLUMES</span> -v <span class="token environment constant">$HOME</span>:<span class="token environment constant">$HOME</span> -v <span class="token environment constant">$HOME</span>:/root&quot;</span> <span class="token comment"># mount $HOME in /root to share docker.config</span>
<span class="token keyword">fi</span>
</code></pre></div><h3 id="only-allocate-tty-if-we-detect-one"><a href="#only-allocate-tty-if-we-detect-one" aria-hidden="true" class="header-anchor">#</a> Only allocate tty if we detect one</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token keyword">if</span> <span class="token punctuation">[</span> -t <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">DOCKER_RUN_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;-t&quot;</span>
<span class="token keyword">fi</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -t <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">DOCKER_RUN_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$DOCKER_RUN_OPTIONS</span> -i&quot;</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">exec</span> docker run --rm <span class="token variable">$DOCKER_RUN_OPTIONS</span> <span class="token variable">$DOCKER_ADDR</span> <span class="token variable">$COMPOSE_OPTIONS</span> <span class="token variable">$VOLUMES</span> -w <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>&quot;</span> <span class="token variable">$IMAGE</span> <span class="token string">&quot;<span class="token variable">$@</span>&quot;</span>
</code></pre></div><p>可以看到，它其实是下载了 docker/compose 镜像并运行。</p> <h3 id="卸载"><a href="#卸载" aria-hidden="true" class="header-anchor">#</a> 卸载</h3> <p>如果是二进制包方式安装的，删除二进制文件即可。</p> <p><code>$ sudo rm /usr/local/bin/docker-compose</code>
如果是通过 pip 安装的，则执行如下命令即可删除。</p> <p><code>$ sudo pip uninstall docker-compose</code></p> <h2 id="docker-compose-使用"><a href="#docker-compose-使用" aria-hidden="true" class="header-anchor">#</a> Docker Compose 使用</h2> <h3 id="术语"><a href="#术语" aria-hidden="true" class="header-anchor">#</a> 术语</h3> <p>首先介绍几个术语。</p> <p>服务 (service)：一个应用容器，实际上可以运行多个相同镜像的实例。
项目 (project)：由一组关联的应用容器组成的一个完整业务单元。
可见，一个项目可以由多个服务（容器）关联而成，Compose 面向项目进行管理。</p> <h3 id="场景"><a href="#场景" aria-hidden="true" class="header-anchor">#</a> 场景</h3> <p>最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。</p> <p>下面我们用 Python 来建立一个能够记录页面访问次数的 web 网站。</p> <h3 id="web-应用"><a href="#web-应用" aria-hidden="true" class="header-anchor">#</a> web 应用</h3> <p>新建文件夹，在该目录中编写 app.py 文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code>from flask <span class="token function">import</span> Flask
   from redis <span class="token function">import</span> Redis
   
   app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
   redis <span class="token operator">=</span> Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'redis'</span>, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">)</span>
   
   @app.route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
   def hello<span class="token punctuation">(</span><span class="token punctuation">)</span>:
       count <span class="token operator">=</span> redis.incr<span class="token punctuation">(</span><span class="token string">'hits'</span><span class="token punctuation">)</span>
       <span class="token builtin class-name">return</span> <span class="token string">'Hello World! 该页面已被访问 {} 次。<span class="token entity" title="\n">\n</span>'</span>.format<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
   
   <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token builtin class-name">:</span>
       app.run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&quot;0.0.0.0&quot;</span>, <span class="token assign-left variable">debug</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
</code></pre></div><h3 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="header-anchor">#</a> Dockerfile</h3> <p>编写 Dockerfile 文件，内容为</p> <p><code> FROM python:3.6-alpine</code> <code>ADD . /code</code> <code>WORKDIR /code</code> <code>RUN pip install redis flask</code> <code>CMD [&quot;python&quot;, &quot;app.py&quot;]</code> <code>### docker-compose.yml</code>
编写 docker-compose.yml 文件，这个是 Compose 使用的主模板文件。</p> <p>version: '3'
services:</p> <pre><code> web:
   build: .
   ports:
    - &quot;5000:5000&quot;
    
 redis:
   image: &quot;redis:alpine&quot;
</code></pre> <h3 id="运行-compose-项目"><a href="#运行-compose-项目" aria-hidden="true" class="header-anchor">#</a> 运行 compose 项目</h3> <p>$ docker-compose up
此时访问本地 5000 端口，每次刷新页面，计数就会加 1。</p> <h2 id="docker-compose-命令说明"><a href="#docker-compose-命令说明" aria-hidden="true" class="header-anchor">#</a> Docker Compose 命令说明</h2> <h3 id="命令对象与格式"><a href="#命令对象与格式" aria-hidden="true" class="header-anchor">#</a> 命令对象与格式</h3> <p>对于 Compose 来说，大部分命令的对象既可以是项目本身，也可以指定为项目中的服务或者容器。如果没有特别的说明，命令对象将是项目，这意味着项目中所有的服务都会受到命令影响。</p> <p>执行 <code>docker-compose [COMMAND] --help</code> 或者<code> docker-compose help [COMMAND]</code> 可以查看具体某个命令的使用格式。</p> <p><code>docker-compose</code> 命令的基本的使用格式是</p> <div class="language-sh extra-class"><pre class="language-sh"><code>docker-compose <span class="token punctuation">[</span>-f<span class="token operator">=</span><span class="token operator">&lt;</span>arg<span class="token operator">&gt;</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARGS<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><h3 id="命令选项"><a href="#命令选项" aria-hidden="true" class="header-anchor">#</a> 命令选项</h3> <p><code>-f, --file FILE</code> 指定使用的 Compose 模板文件，默认为 docker-compose.yml，可以多次指定。
<code>-p, --project-name NAME</code> 指定项目名称，默认将使用所在目录名称作为项目名。
<code>--x-networking </code>使用 Docker 的可拔插网络后端特性
<code>--x-network-driver DRIVER </code> 指定网络后端的驱动，默认为 bridge
<code>--verbose</code> 输出更多调试信息。
<code>-v, --version</code> 打印版本并退出。</p> <h3 id="命令使用说明"><a href="#命令使用说明" aria-hidden="true" class="header-anchor">#</a> 命令使用说明</h3> <h4 id="build"><a href="#build" aria-hidden="true" class="header-anchor">#</a> build</h4> <p>格式为 <code>docker-compose build [options] [SERVICE...]</code></p> <p>构建（重新构建）项目中的服务容器。</p> <p>服务容器一旦构建后，将会带上一个标记名，例如对于 web 项目中的一个 db 容器，可能是 web_db。</p> <p>可以随时在项目目录下运行 docker-compose build 来重新构建服务。</p> <p>选项包括：</p> <p>--force-rm 删除构建过程中的临时容器。
--no-cache 构建镜像过程中不使用 cache（这将加长构建过程）。
--pull 始终尝试通过 pull 来获取更新版本的镜像。</p> <h4 id="config"><a href="#config" aria-hidden="true" class="header-anchor">#</a> config</h4> <p>验证 Compose 文件格式是否正确，若正确则显示配置，若格式错误显示错误原因。</p> <h4 id="down"><a href="#down" aria-hidden="true" class="header-anchor">#</a> down</h4> <p>此命令将会停止 up 命令所启动的容器，并移除网络</p> <h4 id="exec"><a href="#exec" aria-hidden="true" class="header-anchor">#</a> exec</h4> <p>进入指定的容器。</p> <h4 id="help"><a href="#help" aria-hidden="true" class="header-anchor">#</a> help</h4> <p>获得一个命令的帮助。</p> <h4 id="images"><a href="#images" aria-hidden="true" class="header-anchor">#</a> images</h4> <p>列出 <code>Compose</code> 文件中包含的镜像。</p> <h4 id="kill"><a href="#kill" aria-hidden="true" class="header-anchor">#</a> kill</h4> <p>格式为 <code>docker-compose kill [options] [SERVICE...]</code></p> <p>通过发送 <code>SIGKILL</code> 信号来强制停止服务容器。</p> <p>支持通过 -s 参数来指定发送的信号，例如通过如下指令发送 SIGINT 信号。</p> <p><code> $ docker-compose kill -s SIGINT</code></p> <h3 id="logs"><a href="#logs" aria-hidden="true" class="header-anchor">#</a> logs</h3> <p>格式为<code> docker-compose logs [options] [SERVICE...]</code></p> <p>查看服务容器的输出。默认情况下，docker-compose 将对不同的服务输出使用不同的颜色来区分。可以通过 --no-color 来关闭颜色。</p> <p>该命令在调试问题的时候十分有用。</p> <h4 id="pause"><a href="#pause" aria-hidden="true" class="header-anchor">#</a> pause</h4> <p>格式为 <code>docker-compose pause [SERVICE...]</code></p> <p>暂停一个服务容器。</p> <h4 id="port"><a href="#port" aria-hidden="true" class="header-anchor">#</a> port</h4> <p>格式为  <code>docker-compose port [options] SERVICE PRIVATE_PORT</code></p> <p>打印某个容器端口所映射的公共端口。</p> <p>选项：</p> <p><code>--protocol=proto</code> 指定端口协议，tcp（默认值）或者 udp。
<code>--index=index</code> 如果同一服务存在多个容器，指定命令对象容器的序号（默认为 1）。</p> <h4 id="ps"><a href="#ps" aria-hidden="true" class="header-anchor">#</a> ps</h4> <p>格式为<code>docker-compose ps [options] [SERVICE...]</code>。</p> <p>列出项目中目前的所有容器。</p> <p>选项：</p> <p><code>-q </code>只打印容器的 ID 信息。</p> <h4 id="pull"><a href="#pull" aria-hidden="true" class="header-anchor">#</a> pull</h4> <p>格式为 <code>docker-compose pull [options] [SERVICE...]</code>。</p> <p>拉取服务依赖的镜像。</p> <p>选项：</p> <p><code>--ignore-pull-failures</code> 忽略拉取镜像过程中的错误。</p> <h4 id="push"><a href="#push" aria-hidden="true" class="header-anchor">#</a> push</h4> <p>推送服务依赖的镜像到 Docker 镜像仓库。</p> <h4 id="restart"><a href="#restart" aria-hidden="true" class="header-anchor">#</a> restart</h4> <p>格式为 <code>docker-compose restart [options] [SERVICE...]</code>。</p> <p>重启项目中的服务。</p> <p>选项：</p> <p><code>-t, --timeout TIMEOUT</code> 指定重启前停止容器的超时（默认为 10 秒）。</p> <h4 id="rm"><a href="#rm" aria-hidden="true" class="header-anchor">#</a> rm</h4> <p>格式为 <code>docker-compose rm [options] [SERVICE...]</code>。</p> <p>删除所有（停止状态的）服务容器。推荐先执行 docker-compose stop 命令来停止容器。</p> <p>选项：</p> <p>-f, --force 强制直接删除，包括非停止状态的容器。一般尽量不要使用该选项。
-v 删除容器所挂载的数据卷。</p> <h4 id="run"><a href="#run" aria-hidden="true" class="header-anchor">#</a> run</h4> <p>格式为 <code>docker-compose run [options] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]</code>。</p> <p>在指定服务上执行一个命令。</p> <p>例如：</p> <p>$ docker-compose run ubuntu ping docker.com
将会启动一个 ubuntu 服务容器，并执行 ping docker.com 命令。</p> <p>默认情况下，如果存在关联，则所有关联的服务将会自动被启动，除非这些服务已经在运行中。</p> <p>该命令类似启动容器后运行指定的命令，相关卷、链接等等都将会按照配置自动创建。</p> <p>两个不同点：</p> <p>给定命令将会覆盖原有的自动运行命令；
不会自动创建端口，以避免冲突。
如果不希望自动启动关联的容器，可以使用 --no-deps 选项，例如</p> <p>$ docker-compose run --no-deps web python manage.py shell
将不会启动 web 容器所关联的其它容器。</p> <p>选项：</p> <p>-d 后台运行容器。
--name NAME 为容器指定一个名字。
--entrypoint CMD 覆盖默认的容器启动指令。
-e KEY=VAL 设置环境变量值，可多次使用选项来设置多个环境变量。
-u, --user=&quot;&quot; 指定运行容器的用户名或者 uid。
--no-deps 不自动启动关联的服务容器。
--rm 运行命令后自动删除容器，d 模式下将忽略。
-p, --publish=[] 映射容器端口到本地主机。
--service-ports 配置服务端口并映射到本地主机。
-T 不分配伪 tty，意味着依赖 tty 的指令将无法运行。</p> <h4 id="scale"><a href="#scale" aria-hidden="true" class="header-anchor">#</a> scale</h4> <p>格式为 <code>docker-compose scale [options] [SERVICE=NUM...]</code>。</p> <p>设置指定服务运行的容器个数。</p> <p>通过 <code>service=num</code> 的参数来设置数量。例如：</p> <p><code>$ docker-compose scale web=3 db=2</code>
将启动 3 个容器运行 web 服务，2 个容器运行 db 服务。</p> <p>一般的，当指定数目多于该服务当前实际运行容器，将新创建并启动容器；反之，将停止容器。</p> <p>选项：</p> <p>-t, --timeout TIMEOUT 停止容器时候的超时（默认为 10 秒）。</p> <h4 id="start"><a href="#start" aria-hidden="true" class="header-anchor">#</a> start</h4> <p>格式为 <code>docker-compose start [SERVICE...]</code>。</p> <p>启动已经存在的服务容器。</p> <h4 id="stop"><a href="#stop" aria-hidden="true" class="header-anchor">#</a> stop</h4> <p>格式为 <code>docker-compose stop [options] [SERVICE...]</code>。</p> <p>停止已经处于运行状态的容器，但不删除它。通过 docker-compose start 可以再次启动这些容器。</p> <p>选项：</p> <p><code>-t, --timeout TIMEOUT</code> 停止容器时候的超时（默认为 10 秒）。</p> <h4 id="top"><a href="#top" aria-hidden="true" class="header-anchor">#</a> top</h4> <p>查看各个服务容器内运行的进程。</p> <h4 id="unpause"><a href="#unpause" aria-hidden="true" class="header-anchor">#</a> unpause</h4> <p>格式为 <code>docker-compose unpause [SERVICE...]</code>。</p> <p>恢复处于暂停状态中的服务。</p> <h4 id="up"><a href="#up" aria-hidden="true" class="header-anchor">#</a> up</h4> <p>格式为<code> docker-compose up [options] [SERVICE...]</code>。</p> <p>该命令十分强大，它将尝试自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务相关容器的一系列操作。</p> <p>链接的服务都将会被自动启动，除非已经处于运行状态。</p> <p>可以说，大部分时候都可以直接通过该命令来启动一个项目。</p> <p>默认情况，docker-compose up 启动的容器都在前台，控制台将会同时打印所有容器的输出信息，可以很方便进行调试。</p> <p>当通过 <code>Ctrl-C </code>停止命令时，所有容器将会停止。</p> <p>如果使用<code> docker-compose up -d</code>，将会在后台启动并运行所有的容器。一般推荐生产环境下使用该选项。</p> <p>默认情况，如果服务容器已经存在，docker-compose up 将会尝试停止容器，然后重新创建（保持使用 volumes-from 挂载的卷），以保证新启动的服务匹配 docker-compose.yml 文件的最新内容。如果用户不希望容器被停止并重新创建，可以使用 docker-compose up --no-recreate。这样将只会启动处于停止状态的容器，而忽略已经运行的服务。如果用户只想重新部署某个服务，可以使用 docker-compose up --no-deps -d &lt;SERVICE_NAME&gt; 来重新创建服务并后台停止旧服务，启动新服务，并不会影响到其所依赖的服务。</p> <p>选项：</p> <p>-d 在后台运行服务容器。
<code>--no-color</code> 不使用颜色来区分不同的服务的控制台输出。
<code>--no-deps</code> 不启动服务所链接的容器。
<code>--force-recreate</code> 强制重新创建容器，不能与 --no-recreate 同时使用。
<code>--no-recreate</code> 如果容器已经存在了，则不重新创建，不能与 --force-recreate 同时使用。
<code>--no-build</code> 不自动构建缺失的服务镜像。
<code>-t, --timeout TIMEOUT </code>停止容器时候的超时（默认为 10 秒）。</p> <h4 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> version</h4> <p>格式为 <code>docker-compose version</code>。</p> <p>打印版本信息</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a8d644b6.js" defer></script><script src="/assets/js/2.b0571e25.js" defer></script><script src="/assets/js/57.c4b7c57f.js" defer></script>
  </body>
</html>
